

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=375,user-scalable=no">
    
    <title>4.1.3. 第三章 &mdash; HashData Warehouse Document 1.0.0 文档</title>
    

    
    

    

    
    
    

    

    
    
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    

    

    
    <link rel="index" title="索引"
          href="../genindex.html"/>
    <link rel="search" title="搜索" href="../search.html"/>
    <link rel="top" title="HashData Warehouse Document 1.0.0 文档" href="../index.html"/>
    <link rel="up" title="4. 最佳实践" href="index.html"/>
    <link rel="next" title="4.1.4. 第四章" href="chapter-4.html"/>
    <link rel="prev" title="4.1.2. 第二章" href="chapter-2.html"/> 

    
    <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

    <div id="header">
        <header class="navbar navbar-static-top navbar-fixed-top" id="top" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://www.hashdata.cn">
                        <img alt="Brand" src="../_static/img/logo.png">
                    </a>
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
                    <ul class="nav navbar-nav navbar-right">
                        <li id="nav-index">
                            <a href="http://www.hashdata.cn">首页</a>
                        </li>
                        <li id="nav-product">
                            <a href="http://www.hashdata.cn/product">产品</a>
                        </li>
                        <li id="nav-case">
                            <a href="http://www.hashdata.cn/case">案例</a>
                        </li>
                        <li id="nav-blog">
                            <a href="http://www.hashdata.cn/blog">博客</a>
                        </li>
                        <li id="nav-doc" class="active">
                            <a href="http://www.hashdata.cn/docs">文档</a>
                        </li>
                        <li class="dropdown" id="nav-aboutus">
                            <a href="aboutus" class="dropdown-toggle" data-toggle="dropdown">酷克数据<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="http://www.hashdata.cn/#block-aboutus-img">关于我们</a></li>
                                <li><a href="http://www.hashdata.cn/aboutus">加入我们</a></li>
                                <li> <a href="http://www.greenplum.net.cn/" target=_blank>社区</a></li>
                            </ul>
                        </li>
                        <li class="try">
			    <a target="_blank" href="https://appcenter.qingcloud.com/apps/app-iwacxg9z">点击试用</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>
    </div>

        <div id="m-header">
	    <nav id="m-nav">
		<button id="m-nav-btn">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		</button>
            <div class="wy-nav-top-search">
                
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <img src="../_static/img/search-icon.png" alt="search" />
    <input type="text" name="q" placeholder="搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
            </div>
	    </nav>
	    <div id="m-index">
		<ul>
		    <li class=""><a href="http://www.hashdata.cn/">首页</a></li>
		    <li class=""><a href="http://www.hashdata.cn/product">产品</a></li>
		    <li class=""><a href="http://www.hashdata.cn/case">案例</a></li>
		    <li class=""><a href="http://www.hashdata.cn/blog">博客</a></li>
		    <li class="active"><a href="http://www.hashdata.cn/docs">文档</a></li>
		    <li class=""><a href="http://www.hashdata.cn/#block-aboutus-img">关于我们</a></li>
		    <li class=""><a href="http://www.hashdata.cn/aboutus">加入我们</a></li>
		</ul>
	    </div>
	</div>


    <div id="content">

<div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="topLevel">
                
                
                
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started-guide/hashdata_warehouse_guide.html">1. 入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster-management-guide/cluster-management-guide.html">2. 管理指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/index.html">3. 开发指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. 最佳实践</a></li>
</ul>

                
                
            </div>

            <div class="wy-side-nav-search">
                

                <!---->
                <!--<a href="../index.html" class="icon icon-home"> HashData Warehouse Document-->
                <!---->

                <!---->
                <!--</a>-->

                <!---->
                <!---->
                <!---->
                <!---->
                <!--<div class="version">-->
                <!--1.0.0-->
                <!--</div>-->
                <!---->
                <!---->

                
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <img src="../_static/img/search-icon.png" alt="search" />
    <input type="text" name="q" placeholder="搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

                
            </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                
                
                
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started-guide/hashdata_warehouse_guide.html">1. 入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster-management-guide/cluster-management-guide.html">2. 管理指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/index.html">3. 开发指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. 最佳实践</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#product-name">4.1. HashData 数据仓库 最佳实践</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="chapter-1.html">4.1.1. HashData 数据仓库 数据仓库最佳实践概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter-2.html">4.1.2. 第二章</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.1.3. 第三章</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter-4.html">4.1.4. 第四章</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter-5.html">4.1.5. 第五章</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter-6.html">4.1.6. 第六章</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter-7.html">4.1.7. 第七章</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                
                
            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

        
        
        
        
        
        
        


        
        <div class="topLevel m-topLevel">
            
            
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started-guide/hashdata_warehouse_guide.html">1. 入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster-management-guide/cluster-management-guide.html">2. 管理指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/index.html">3. 开发指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. 最佳实践</a></li>
</ul>

            
        </div>

        
        <div class="wy-nav-content">
            <div class="rst-content">
                

<!-- -->
<!---->
<!---->

<!--<div role="navigation" aria-label="breadcrumbs navigation">-->
  <!--<ul class="wy-breadcrumbs">-->
    <!--<li><a href="../index.html">Docs</a> &raquo;</li>-->
      <!---->
          <!--<li><a href="index.html">4. 最佳实践</a> &raquo;</li>-->
      <!---->
    <!--<li>4.1.3. 第三章</li>-->
      <!--<li class="wy-breadcrumbs-aside">-->
        <!---->
          <!---->
            <!--<a href="../_sources/best-practices/chapter-3.rst.txt" rel="nofollow"> View page source</a>-->
          <!---->
        <!---->
      <!--</li>-->
  <!--</ul>-->
  <!--<hr/>-->
<!--</div>-->
                <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                    <div itemprop="articleBody">
                        
  <div class="section" id="id1">
<h1>4.1.3. 第三章<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>4.1.3.1. 数据库模式设计<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>HashData 数据仓库 是一个基于大规模并行处理（MPP）和无共享架构的数据仓库。这种分析型数据库的数据模式与高度规范化的事务性OLTP数据库显著不同。使用非规范化数据仓库模式，例如具有大事实表和小维度表的星型或者雪花模式，处理MPP分析型业务时，HashData 数据仓库 数据仓库表现优异。</p>
</div>
<div class="section" id="id3">
<h2>4.1.3.2. 数据类型<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<div class="section" id="id4">
<h3>4.1.3.2.1. 类型一致性<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>关联列使用相同的数据类型。如果不同表中的关联列数据类型不同，HashData 数据仓库 必须动态的进行类型转换以进行比较。考虑到这一点，你可能需要增大数据类型的大小，以便关联操作更高效。</p>
</div>
<div class="section" id="id5">
<h3>4.1.3.2.2. 类型最小化<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>建议选择最高效的类型存储数据，这可以提高数据库的有效容量及查询执行性能。
建议使用 TEXT 或者 VARCHAR 而不是CHAR。不同的字符类型间没有明显的性能差别，但是 TEXT 或者 VARCHAR 可以降低空间使用量。
建议使用满足需求的最小数值类型。如果 INT 或 SAMLLINT 够用，那么选择 BIGINT 会浪费空间。</p>
</div>
</div>
<div class="section" id="id6">
<h2>4.1.3.3. 存储模型<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>在 HashData 数据仓库 数据仓库中，创建表时可以选择不同的存储类型。需要清楚什么时候该使用堆存储、什么时候使用追加优化(AO)存储、什么时候使用行存储、什么时候使用列存储。对于大型事实表这尤为重要。相比而言，对小的维度表就不那么重要了。
选择合适存储模型的常规最佳实践为：</p>
<p>1.对于大型事实分区表，评估并优化不同分区的存储选项。一种存储模型可能满足不了整个分区表的不同分区的应用场景，例如某些分区使用行存储而其他分区使用列存储。</p>
<p>2.使用列存储时，段数据库内每一列对应一个文件。对于有大量列的表，经常访问的数据使用列存储，不常访问的数据使用行存储。</p>
<p>3.在分区级别或者在数据存储级别上设置存储类型。</p>
<p>4.如果集群需要更多空间，或者期望提高 I/O 性能，考虑使用压缩。</p>
<div class="section" id="ao">
<h3>4.1.3.3.1. 堆存储和AO存储<a class="headerlink" href="#ao" title="永久链接至标题">¶</a></h3>
<p>堆存储是默认存储模型，也是 PostgreSQL 存储所有数据库表的模型。如果表和分区经常执行 UPDATE、DELETE 操作或者单个 INSERT 操作，则使用堆存储模型。如果需要对表和分区执行并发 UPDATE、DELETE、INSERT 操作，也使用堆存储模型。</p>
<p>如果数据加载后很少更新，之后的插入也是以批处理方式执行，则使用追加优化(AO)存储模型。千万不要对AO表执行单个 INSERT/UPDATE/DELETE 操作。并发批量 INSERT 操作是可以的，但是不要执行并发批量 UPDATE 或者 DELETE 操作。</p>
<p>AO表中执行删除和更新操作后行所占空间的重用效率不如堆表，所以这种存储类型不适合频繁更新的表。AO表主要用于分析型业务中加载后很少更新的大表。</p>
</div>
<div class="section" id="id7">
<h3>4.1.3.3.2. 行存储和列存储<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>行存储是存储数据库元组的传统方式。一行的所有列在磁盘上连续存储，所以一次I/O可以从磁盘上读取整个行。</p>
<p>列存储在磁盘上将同一列的值保存在一块。每一列对应一个单独的文件。如果表是分区表，那么每个分区的每个列对应一个单独的文件。如果列存储表有很多列，而SQL查询只访问其中的少量列，那么I/O开销与行存储表相比大大降低，因为不需要从磁盘上读取不需要访问的列。</p>
<p>交易型业务中更新和插入频繁，建议使用行存储。如果需要同时访问宽表的很多字段时，建议使用行存储。如果大多数字段会出现在 SELECT 列表中或者 WHERE 子句中，建议使用行存储。对于通用的混合型负载，建议使用行存储。行存储提供了灵活性和性能的最佳组合。</p>
<p>列存储是为读操作而非写操作优化的一种存储方式，不同字段存储在磁盘上的不同位置。对于有很多字段的大型表，如果单个查询只需访问较少字段，那么列存储性能优异。</p>
<p>列存储的另一个好处是相同类型的数据存储在一起比混合类型数据占用的空间少，因而列存储表比行存储表使用的磁盘空间小。列存储的压缩比也高于行存储。</p>
<p>数据仓库的分析型业务中，如果SELECT访问少量字段或者在少量字段上执行聚合计算，则建议使用列存储。如果只有单个字段需要频繁更新而不修改其他字段，则建议列存储。从一个宽列存储表中读完整的行比从行存储表中读同一行需要更多时间。特别要注意的是，HashData每个段数据库上每一列都是一个独立的物理文件。</p>
</div>
</div>
<div class="section" id="id8">
<h2>4.1.3.4. 压缩<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>HashData 数据仓库 数据仓库为AO表和分区提供多种压缩选项。使用压缩后，每次磁盘读操作可以读入更多的数据，因而可以提高I/O性能。建议在实际保存物理数据的那一层设置字段压缩方式。</p>
<p>请注意，新添加的分区不会自动继承父表的压缩方式，必须在创建新分区时明确指定压缩选项。</p>
<p>Delta 和 RLE 的压缩比较高。高压缩比使用的磁盘空间较少，但是在写入数据或者读取数据时需要额外的时间和 CPU 周期进行压缩和解压缩。压缩和排序联合使用，可以达到最好的压缩比。</p>
<p>在压缩文件系统上不要再使用数据库压缩。</p>
<p>测试不同的压缩类型和排序方法以确定最适合自己数据的压缩方式。</p>
</div>
<div class="section" id="distributions">
<h2>4.1.3.5. 分布(DISTRIBUTIONS)<a class="headerlink" href="#distributions" title="永久链接至标题">¶</a></h2>
<p>选择能够均匀分布数据的分布键对 HashData 数据仓库 数据仓库非常重要。在大规模并行处理无共享环境中，查询的总体响应时间取决于所有段数据库的完成时间。集群的最快速度与最慢的那个段数据库一样。如果存在严重数据倾斜现象，那么数据较多的段数据库响应时间将更久。每个段数据库最好有数量接近的数据，处理时间也相似。如果一个段数据库处理的数据显著比其他段多，那么性能会很差，并可能出现内存溢出错误。</p>
<p>确定分布策略时考虑以下最佳实践：</p>
<ul class="simple">
<li>为所有表要么明确地指明其分布字段，要么使用随机分布。不要使用默认方式。</li>
<li>理想情况下，使用能够将数据均匀分布到所有段数据库上的一个字段做分布键。</li>
<li>不要使用常出现在查询的 WHERE 子句中的字段做分布键。</li>
<li>不要使用日期或者时间字段做分布键。</li>
<li>分布字段的数据要么是唯一值要么基数很大。</li>
<li>如果单个字段不能实现数据均匀分布，则考虑使用两个字段做分布键。作为分布键的字段最好不要超过两个。HashData 数据仓库 使用哈希进行数据分布，使用更多的字段通常不能得到更均匀的分布，反而耗费更多的时间计算哈希值。</li>
<li>如果两个字段也不能实现数据的均匀分布，则考虑使用随机分布。大多数情况下，如果分布键字段超过两个，那么执行表关联时通常需要节点间的数据移动操作（Motion），如此一来和随机分布相比，没有明显优势。</li>
</ul>
<p>HashData 数据仓库 数据仓库的随机分布不是轮询算法，不能保证每个节点的记录数相同，但是通常差别会小于 10%。</p>
<p>关联大表时最优分布至关重要。关联操作需要匹配的记录必须位于同一段数据库上。如果分布键和关联字段不同，则数据需要动态重分发。某些情况下，广播移动操作（Motion）比重分布移动操作效果好。</p>
<div class="section" id="co-located">
<h3>4.1.3.5.1. 本地（Co-located）关联<a class="headerlink" href="#co-located" title="永久链接至标题">¶</a></h3>
<p>如果所用的哈希分布能均匀分布数据，并导致本地关联，那么性能会大幅提升。本地关联在段数据库内部执行，和其他段数据库没有关系，避免了网络通讯开销，避免或者降低了广播移动操作和重分布移动操作。</p>
<p>为经常关联的大表使用相同的字段做分布键可实现本地关联。本地关联需要关联的双方使用相同的字段（且顺序相同）做分布键，并且关联时所有的字段都被使用。分布键数据类型必须相同。如果数据类型不同，磁盘上的存储方式可能不同，那么即使值看起来相同，哈希值也可能不一样。</p>
</div>
<div class="section" id="id9">
<h3>4.1.3.5.2. 数据倾斜<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>数据倾斜是很多性能问题和内存溢出问题的根本原因。数据倾斜不仅影响扫描/读性能，也会影响很多其他查询执行操作符，例如关联操作、分组操作等。</p>
<p>数据初始加载后，验证并保证数据分布的均匀性非常重要；每次增量加载后，都要验证并保证数据分布的均匀性。</p>
<p>下面的查询语句统计每个段数据库上的记录的条数，并根据最大和最小行数计算方差：</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="s1">&#39;Example Table&#39;</span> <span class="k">AS</span> <span class="ss">&quot;Table Name&quot;</span><span class="p">,</span>
     <span class="k">max</span><span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;Max Seg Rows&quot;</span><span class="p">,</span> <span class="k">min</span><span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;Min Seg Rows&quot;</span><span class="p">,</span>
     <span class="p">(</span><span class="k">max</span><span class="p">(</span><span class="k">c</span><span class="p">)</span><span class="o">-</span><span class="k">min</span><span class="p">(</span><span class="k">c</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="k">max</span><span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;Percentage Difference Between Max &amp; Min&quot;</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">c</span><span class="p">,</span> <span class="n">gp_Segment_id</span> <span class="k">FROM</span> <span class="n">facts</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
<p><em>gp_tooklit</em> 模式中有两个视图可以帮助检查倾斜情况：</p>
<ul class="simple">
<li>视图 <em>gp_toolkit.gp_skew_coefficients</em> 通过计算每个段数据库所存储数据的变异系数（coefficient of variation, CV）来显示数据倾斜情况。<em>skccoeff</em> 字段表示变异系数，通过标准偏差除以均值计算而来。它同时考虑了数据的均值和可变性。这个值越小越好，值越高表示数据倾斜越严重。</li>
<li>视图 <em>gp_toolkit.gp_skew_idle_fractions</em> 通过计算表扫描时系统空闲的百分比显示数据分布倾斜情况，这是表示计算倾斜情况的一个指标。<em>siffraction</em> 字段显示了表扫描时处于空闲状态的系统的百分比。这是数据不均匀分布或者查询处理倾斜的一个指标。例如，0.1 表示 10% 倾斜，0.5 表示 50% 倾斜，以此类推。如果倾斜超过 10%，则需对其分布策略进行评估。</li>
</ul>
</div>
<div class="section" id="procedding-skew">
<h3>4.1.3.5.3. 计算倾斜（Procedding Skew）<a class="headerlink" href="#procedding-skew" title="永久链接至标题">¶</a></h3>
<p>当不均衡的数据流向并被某个或者少数几个段数据库处理时将出现计算倾斜。这常常是 HashData 数据仓库 数据仓库性能和稳定性问题的罪魁祸首。关联、排序、聚合和各种OLAP操作中易发生计算倾斜。计算倾斜发生在查询执行时，不如数据倾斜那么容易检测，通常是由于选择了不当的分布键造成数据分布不均匀而引起的。数据倾斜体现在表级别，所以容易检测，并通过选择更好的分布键避免。</p>
<p>如果单个段数据库失败（不是某个节点上的所有段实例），那么可能是计算倾斜造成的。识别计算倾斜目前主要靠手动。首先查看临时溢出文件，如果有计算倾斜，但是没有造成临时溢出文件，则不会影响性能。下面是检查的步骤和所用的命令：</p>
<ol class="arabic simple">
<li>找到怀疑发生计算倾斜的数据库的 OID：</li>
</ol>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">oid</span><span class="p">,</span> <span class="n">datname</span> <span class="k">FROM</span> <span class="n">pg_database</span><span class="p">;</span>
</pre></div>
</div>
<p>例子输出:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>   <span class="n">oid</span> <span class="o">|</span> <span class="n">datname</span>
<span class="o">-------+-----------</span>
 <span class="mi">17088</span> <span class="o">|</span> <span class="n">gpadmin</span>
 <span class="mi">10899</span> <span class="o">|</span> <span class="n">postgres</span>
     <span class="mi">1</span> <span class="o">|</span> <span class="n">template1</span>
 <span class="mi">10898</span> <span class="o">|</span> <span class="n">template0</span>
 <span class="mi">38817</span> <span class="o">|</span> <span class="n">pws</span>
 <span class="mi">39682</span> <span class="o">|</span> <span class="n">gpperfmon</span>
<span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>使用 gpssh 检查所有 Segments 上的溢出文件大小。使用上面结果中的 OID 替换 :</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>[gpadmin@mdw?kend]$ gpssh -f ~/hosts -e \
    &quot;du -b /data[1-2]/primary/gpseg*/base/&lt;OID&gt;/pgsql_tmp/*&quot; | \
    grep -v &quot;du -b&quot; | sort | \ awk -F&quot; &quot; &#39;{ arr[$1] = arr[$1] + $2 ; tot = tot +
$2 }; \ END
    { for ( i in arr ) print &quot;Segment node&quot; i, arr, \ &quot;bytes (&quot; arr/(1024**3)&quot;
GB)&quot;; \
 print &quot;Total&quot;, tot, &quot;bytes (&quot; tot/(1024**3)&quot; GB)&quot; }&#39; -
</pre></div>
</div>
<p>###例子输出:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="mi">2443370457</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">2.27557</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="mi">1766575328</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.64525</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="mi">1761686551</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.6407</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="mi">1780301617</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.65804</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="mi">1742543599</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.62287</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="mi">1830073754</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.70439</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="mi">1767310099</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.64594</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Segment</span> <span class="n">node</span><span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="mi">1765105802</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">1.64388</span> <span class="n">GB</span><span class="p">)</span>
<span class="n">Total</span> <span class="mi">14856967207</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mf">13.8366</span> <span class="n">GB</span><span class="p">)</span>
</pre></div>
</div>
<p>如果不同段数据库的磁盘使用量持续差别巨大，那么需要一进步查看当前执行的查询是否发生了计算倾斜（上面的例子可能不太恰当，因为没有显示出明显的倾斜）。 在很多监控系统中，总是会发生某种程度的倾斜，如果仅是临时性的，则不必深究。</p>
<ol class="arabic simple" start="3">
<li>如果发生了严重的持久性倾斜，接下来的任务是找到有问题的查询。</li>
</ol>
<p>上一步命令计算的是整个节点的磁盘使用量。现在我们要找到对应的段数据库(Segment)目录。可以从主节点（Master）上， 也可以登录到上一步识别出的Segment上做本操作。下面例子演示从 Master 执行操作。</p>
<p>本例找的是排序生成的临时文件。然而并不是所有情况都是由排序引起的，需要具体问题具体分析：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[gpadmin@mdw?kend]$ gpssh -f ~/hosts -e \
   &quot;ls -l /data[1-2]/primary/gpseg*/base/19979/pgsql_tmp/*&quot;
   | grep -i sort | sort
</pre></div>
</div>
<p>下面是例子输出：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002209280</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg2</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19791_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1003356160</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg1</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19789_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">288718848</span> <span class="n">Jul</span> <span class="mi">23</span> <span class="mi">14</span><span class="p">:</span><span class="mi">58</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg2</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice0_sort_17758_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">291176448</span> <span class="n">Jul</span> <span class="mi">23</span> <span class="mi">14</span><span class="p">:</span><span class="mi">58</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg5</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice0_sort_17764_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">988446720</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg0</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19787_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">995033088</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg3</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19793_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">997097472</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg5</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19797_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw1</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">997392384</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg4</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_19795_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002340352</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg11</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3973_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1004339200</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg8</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3967_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">989036544</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg10</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3971_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">993722368</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg6</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3963_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">998277120</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg7</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3965_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw2</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">999751680</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg9</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_3969_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1000112128</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg13</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24723_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1004797952</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg17</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24731_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1004994560</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg15</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24727_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1006108672</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg14</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24725_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">998244352</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg12</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24721_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw3</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">998440960</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg16</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_24729_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1001029632</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg23</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29435_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002504192</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg20</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29429_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002504192</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg21</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29431_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1009451008</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg19</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29427_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">980582400</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg18</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29425_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw4</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">993230848</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg22</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29433_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1000898560</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg28</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_28641_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1003388928</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg29</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_28643_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1008566272</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg24</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_28633_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">987332608</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg25</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span>
<span class="n">pgsql_tmp</span><span class="o">/</span><span class="n">pgsql_tmp_slice10_sort_28635_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">990543872</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg27</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_28639_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw5</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">999620608</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg26</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_28637_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002242048</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg33</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29598_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1003683840</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg31</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29594_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1004732416</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg34</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29600_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">986447872</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg35</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29602_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">990543872</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg30</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29592_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw6</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">992870400</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg32</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_29596_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1007321088</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg39</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18530_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1011187712</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg37</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18526_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">987332608</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg41</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18534_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">994344960</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg38</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18528_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">996114432</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg40</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18532_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw7</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">999194624</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg36</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_18524_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1002242048</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg46</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15675_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1003520000</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg43</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15669_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1008009216</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg44</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15671_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">16</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">21</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0002</span><span class="o">.</span><span class="mi">1</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">24</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0003</span><span class="o">.</span><span class="mi">2</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">26</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0004</span><span class="o">.</span><span class="mi">3</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">31</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0006</span><span class="o">.</span><span class="mi">5</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0005</span><span class="o">.</span><span class="mi">4</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">34</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0007</span><span class="o">.</span><span class="mi">6</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">36</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0008</span><span class="o">.</span><span class="mi">7</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">1073741824</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">43</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0009</span><span class="o">.</span><span class="mi">8</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">924581888</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg45</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15673_0010</span><span class="o">.</span><span class="mi">9</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">990085120</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data1</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg42</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15667_0001</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">sdw8</span><span class="p">]</span> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">gpadmin</span> <span class="n">gpadmin</span> <span class="mi">996933632</span> <span class="n">Jul</span> <span class="mi">29</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span>
       <span class="o">/</span><span class="n">data2</span><span class="o">/</span><span class="n">primary</span><span class="o">/</span><span class="n">gpseg47</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="mi">19979</span><span class="o">/</span><span class="n">pgsql_tmp</span><span class="o">/</span>
<span class="n">pgsql_tmp_slice10_sort_15677_0001</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>从结果可以发现主机 sdw8 上的Segment gpseg45 是罪魁祸首。</p>
<p>4.使用 SSH 登录到有问题的节点，并切换为 root 用户，使用 <em>lsof</em> 找到拥有排序临时文件的进程 PID。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[root@sdw8?~]# lsof /data2/primary/gpseg45/base/19979/pgsql_tmp/
pgsql_tmp_slice10_sort_15673_0002.1
COMMAND    PID    USER    FD    TYPE    DEVICE    SIZE    NODE    NAME
postgres  15673  gpadmin  11u  REG  8,48  1073741824  64424546751/data2/primary/
gpseg45/base/19979/pgsql_tmp/pgsql_tmp_slice10_sort_15673_0002.1
</pre></div>
</div>
<p>这个例子中 PID 15673 也是文件名的一部分，然而并不是所有的临时溢出文件名都包含进程PID。</p>
<ol class="arabic simple" start="5">
<li>使用ps命令识别 PID 对应的数据库和连接信息。</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>[root@sdw8?~]# ps -eaf | grep 15673
gpadmin 15673 27471 28 12:05          00:12:59 postgres: port 40003, sbaskin bdw
       172.28.12.250(21813) con699238 seg45 cmd32 slice10 MPPEXEC SELECT
root 29622 29566 0 12:50 pts/16 00:00:00 grep 15673
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>最后，我们可以找到造成倾斜的查询语句。到主节点（Master）上，根据用户名 (sbaskin)、连接信息(con699238) 和命令信息(cmd32)查找pg_log下面的日志文件。找到对应的日志行，该行应该包含出问题的查询语句。 有时候cmd数字可能不一致。例如 ps 输出中 postgres 进程显示的是 cmd32，而日志中可能会是 cmd34。 如果分析的是正在运行的查询语句，则用户在对应连接上运行的最后一条语句就是出问题的查询语句。</li>
</ol>
<p>大多数情况下解决这种问题是重写查询语句。创建临时表可以避免倾斜。设置临时表使用随机分布，这样会强制执行两阶段聚合(two-stage aggregation)。</p>
</div>
</div>
<div class="section" id="partitioning">
<h2>4.1.3.6. 分区（PARTITIONING)<a class="headerlink" href="#partitioning" title="永久链接至标题">¶</a></h2>
<p>好的分区策略可以让查询只扫描需要访问的分区，以降低扫描的数据量。</p>
<p>在每个段数据库上的每个分区都是一个物理文件。读取分区表的所有分区比读取相同数据量的非分区表需要更多时间。</p>
<p>以下是分区最佳实践：</p>
<ul class="simple">
<li>只为大表设置分区，不要为小表设置分区。</li>
<li>仅在根据查询条件可以实现分区裁剪时对大表使用分区。</li>
<li>建议优先使用范围 (Range) 分区，否则使用列表 (List) 分区。</li>
<li>仅当SQL查询包含使用不变操作符（例如=，&lt;, &lt;=, &gt;=, &lt;&gt;）的简单直接的约束时，查询优化器才会执行分区裁剪。</li>
<li>选择性扫描可以识别查询中的 STABLE 和 IMMUTABLE 函数，但是不能识别 VOLATILE 函数。例如查询优化器对下面的 WHERE 子句</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="o">&gt;</span> <span class="n">CURRENT_DATE</span>
</pre></div>
</div>
<p>可以启用分区裁剪，但是如果WHERE子句如下则不会启用分区裁剪。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">TIMEOFDAY</span>
</pre></div>
</div>
<p>通过检查查询的 EXPLAIN 计划验证是否执行分区裁剪非常重要。</p>
<ul class="simple">
<li>不要使用默认分区。默认分区总是会被扫描，更重要的是很多情况下会导致溢出而造成性能不佳。</li>
<li>切勿使用相同的字段既做分区键又做分布键。</li>
<li>避免使用多级分区。虽然支持子分区但不推荐，因为通常子分区包含数据不多甚至没有。随着分区或者子分区增多性能可能会提高，然而维护这些分区和子分区的代价将超过性能的提升。基于性能、扩展性和可管理性，在扫描性能和分区总数间取得平衡。</li>
<li>对于列存储的表，慎用过多的分区。</li>
<li>考虑好并发量和所有并发查询打开和扫描的分区均值。</li>
</ul>
<div class="section" id="id10">
<h3>4.1.3.6.1. 分区数目和列存储文件<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>HashData 数据仓库 数据仓库对于文件数目的唯一硬性限制是操作系统的打开文件限制。然而也需要考虑到集群的文件总数、每个段数据库(Segment)上的文件数和每个主机上的文件总数。在MPP无共享环境中，节点独立运行。每个节点受其磁盘、CPU和内存的约束。HashData 数据仓库 数据仓库中CPU和I/O较少成为瓶颈，而内存却比较常见，因为查询执行器需要使用内存优化查询的性能。</p>
<p>Segment的最佳文件数与每个主机节点上Segment个数、集群大小、SQL访问模式、并发度、负载和倾斜等都有关系。通常一个主机上配置六到八个Segments，对于大集群建议为每个主机配置更少的Segment。使用分区和列存储时平衡集群中的文件总数很重要，但是更重要的是考虑好每个Segment的文件数和每个主机上的文件数。</p>
<p>例如数据仓库集群中每个节点64GB内存：</p>
<ul class="simple">
<li>节点数：16</li>
<li>每个节点Segment数：8</li>
<li>每个Segment的文件均数：10000</li>
</ul>
<p>一个节点的文件总数是：8*10000 = 80000，集群的文件总数是：8 * 16 * 10000 = 1280000. 随着分区增加和列字段的增加，文件数目增长很快。</p>
<p>作为一个最佳实践，单个节点的文件总数上限为 100000。如前面例子所示，Segment的最佳文件数和节点的文件总数和节点的硬件配置（主要是内存）、集群大小、SQL访问、并发度、负载和数据倾斜等相关。</p>
</div>
</div>
<div class="section" id="id11">
<h2>4.1.3.7. 索引<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>HashData 数据仓库 数据仓库通常不用索引，因为大多数的分析型查询都需要处理大量数据，而顺序扫描时数据读取效率较高，因为每个段数据库(Segment)含有数量相当的数据，且所有 Segment 并行读取数据。</p>
<p>对于具有高选择性的查询，索引可以提高查询性能。</p>
<p>即使明确需要索引，也不要索引经常更新的字段。对频繁更新的字段建立索引会增加数据更新时写操作的代价。</p>
<p>仅当表达式常在查询中使用时才建立基于表达式的索引。</p>
<p>谓词索引会创建局部索引，可用于从大表中选择少量行的情况。</p>
<p>避免重复索引。具有相同前缀字段的索引是冗余的。</p>
<p>对于压缩AO表，索引可以提高那些指返回少量匹配行的查询的性能。对于压缩数据，索引可以降低需要解压缩的页面数。</p>
<p>创建选择性高的B树索引。索引选择性是指：表的索引字段的不同值总数除以总行数。例如，如果一个表有1000行，索引列具有800个不同的值，那么该索引的选择性为 0.8，这是一个良好的选择性值。</p>
<p>如果创建索引后查询性能没有显著地提升，则删除该索引。确保创建的每个索引都被优化器采用。</p>
<p>加载数据前务必删除索引。加载速度比带索引快一个数量级。加载完成后，重建索引。</p>
<p>位图索引适合查询而不适合更新业务。当列的基数较低（譬如100到100000个不同值）时位图索引性能最好。不要对唯一列、基数很高的列或者基数很低的列建立位图索引。不要为业务性负载使用位图索引。</p>
<p>一般来说，不要索引分区表。如果需要，索引字段不要和分区字段相同。分区表索引的一个优势在于：随着B树的增大，B树的性能呈指数下降，因而分区表上创建的索引对应的B树比较小，性能比非分区表好。</p>
</div>
<div class="section" id="id12">
<h2>4.1.3.8. 字段顺序和字节对齐<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p>为了获得最佳性能，建议对表的字段顺序进行调整以实现数据类型的字节对齐。对堆表使用下面的顺序：</p>
<ol class="arabic simple">
<li>分布键和分区键</li>
<li>固定长度的数值类型</li>
<li>可变长度的数据类型</li>
</ol>
<p>从大到小布局数据类型，BIGINT和TIMESTAMP 在 INT 和 DATE 类型之前，TEXT，VARCHAR和NUMERIC(x,y)位于后面。例如首先定义8字节的类型（BIGINT，TIMESTAMP）字段，然后是4字节类型（INT，DATE），随后是2字节类型（SMALLINT），最后是可变长度数据类型（VARCHAR）。
如果你的字段定义如下：</p>
<p>Int, Bigint, Timestamp, Bigint, Timestamp, Int (分布键), Date (分区键), Bigint,Smallint</p>
<p>则建议调整为：</p>
<p>Int (分布键), Date (分区键), Bigint, Bigint, Bigint, Timestamp, Timestamp, Int, Smallint</p>
</div>
</div>


                    </div>
                </div>
                <footer> 

</footer>

            </div>
        </div>

    </section>

</div>


</div>



<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'1.0.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
    };
</script>
<script type="text/javascript" src="../_static/jquery.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/translations.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>





<script type="text/javascript" src="../_static/js/theme.js"></script>

<script src="../_static/js/bootstrap/bootstrap.min.js"></script>
<script>

$(function() {
    var triIcon = "../_static/img/tri-icon.png";
    $('.document .section h2').append( '<img src=' + triIcon + ' />' );
    $('.document .section h2').click(function() {
        $(this).parent().toggleClass('closed');
    });
});

$(function(){
    $('#m-nav-btn, #m-index li').click(function(e){
            $('#m-index').slideToggle(300, function(){
                $('#m-index').css('display') == "block" ?
                $('#m-header').css('background-color','#fff') :
                $('#m-header').css('background-color','rgba(255,255,255,0.9)');
            });
        });
        $('#content, #m-footer').click(function(){
            $('#m-index').slideUp();
            $('#m-header').css('background-color','rgba(255,255,255,0.9)')
        });

    /*
    $('.topLevel .toctree-l1 a.reference').each(function(index, ele) {
        var contentStr = ele. innerHTML;
        var aSet = new Set(['1.', '2.', '3.']);
        if (aSet.has(contentStr.substr(0,2)))
            ele.innerHTML = contentStr.substr(2);
    });
    */

});

</script>



<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.StickyNav.enable();
    });
</script>



<div id="footer">
    <footer id="footer-1">
	<div class="container">
	    <div class="footer-block col-lg-3 col-lg-offset-2 col-md-4 col-md-offset-1 col-sm-5 col-xs-5">
		<div class="logo">
		    <img src="../_static/img/footer-logo.png"/>
		</div>
		<p>北京酷克数据科技有限公司</p>
		<p>地址：北京市朝阳区望京博泰国际A座1506</p>
	    </div>
	    <div class="footer-block col-lg-3 col-md-4 col-sm-5 col-xs-5">
		<p class="title">联系地址</p>
		<p>电话：010-64710206</p>
		<p>微博：@HashData</p>
		<p>邮件：business@hashdata.cn</p>
	    </div>
	    <div class="footer-block qrcode col-lg-3 col-md-3">
		<p class="title">微信公众号</p>
		<img src="../_static/img/qrcode.png"/>
	    </div>
	</div>
    </footer>
    <footer id="footer-2">
	<p>Copyright © 2016 HashData Ltd. 京ICP备16019672号-1</p>
	<p><span class="emblem"></span>京公安网备11010502031309号</p>
    </footer>
</div>

<div id="m-footer">
    <div id="m-footer-bg"></div>
    <footer id="footer-1">
	<div class="logo"><img src="../_static/img/footer-logo.png" /></div>
	<div class="address">
	    <p>北京酷克数据科技有限公司</p>
	    <p>地址：北京市朝阳区望京博泰国际A座1506</p>
	</div>
	<div class="connect">
	    <p class="title">联系地址</p>
	    <p>电话：010-64710206</p>
	    <p>微博：@HashData</p>
	    <p>邮件：business@hashdata.cn</p>
	    <p>扫描二维码关注公众号：</p>
	    <div class="qrcode">
		<img src="../_static/img/qrcode.png"/>
	    </div>
	</div>
    </footer>
    <footer id="footer-2">
	<div class="copyright">
	    <p>Copyright © 2016 HashData Ltd. 京ICP备16019672号-1</p>
	    <p><span></span>京公安网备11010502031309号</p>
	</div>
    </footer>
</div>




</body>
</html>